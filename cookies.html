<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>포춘쿠키 이벤트</title>
  <link rel="stylesheet" href="./style.css">
</head>
  <body>
    <div class="container cookies">
      <h1>오늘의 포춘쿠키</h1>
      <p id="message"></p>
      <div class="cookie" id="cookie"></div>
      <div class="message" id="messageBox"></div>
      <button id="reviewBtn" onclick="submitCookies()">응모하기</button>
      <button id="backBtn" onclick="location.href = 'main.html'">뒤로가기</button>
    </div>
        
    <script>
      const cookie = document.getElementById("cookie");
      const messageBox = document.getElementById("messageBox");
      const button = document.getElementById("reviewBtn");

      const fortunes = [
        "당신은 생각보다 강하다",
        "기회는 준비된 자의 것",
        "성공은 용기의 또 다른 이름",
        "멈춤은 도약을 위한 숨고르기",
        "오늘의 한 걸음이 내일을 바꾼다",
        "빛은 스스로를 태워야 나온다",
        "가장 어두운 밤에도 별은 뜬다",
        "넘어진 곳에서 일어나는 법을 배운다",
        "불가능은 아직 시도되지 않은 것",
        "흔들려야 꽃이 핀다",
        "당신의 가능성은 무한하다",
        "진짜 용기는 조용히 나아가는 것",
        "나아가야 길이 된다",
        "천천히 가도 괜찮아, 멈추지만 마",
        "지금 이 순간도 누군가의 꿈이다",
        "작은 친절이 큰 기적이 된다",
        "한 줄기 바람도 돛을 밀 수 있다",
        "어제보다 나은 오늘을 만들자",
        "당신은 이미 충분히 빛나고 있다"
      ];
      
      window.onload = () => {
        const hasSubmitted = localStorage.getItem('hasSubmitted') === 'true';
        const savedFortune = localStorage.getItem('fortuneMessage');

        if (hasSubmitted) {
          button.disabled = true;
          button.textContent = "이미 응모하셨습니다";
          document.querySelector('#backBtn').style.display = 'block';

          if (savedFortune) {
            messageBox.textContent = savedFortune;
            messageBox.classList.add("show");
          }
        }
      };

      function submitCookies () {
        if (localStorage.getItem('hasSubmitted') === 'true') return;

        cookie.classList.add("crack");
        messageBox.classList.remove("show");
        
        setTimeout(() => {
          const randomIndex = Math.floor(Math.random() * fortunes.length);
          const selectedFortune = fortunes[randomIndex];
          
          // alert("🥠" + selectedFortune + "🥠");
          
          messageBox.textContent = selectedFortune;
          messageBox.classList.add("show");
          
          localStorage.setItem('hasSubmitted', 'true');
          localStorage.setItem('fortuneMessage', selectedFortune);
          button.disabled = true;
          button.textContent = "이미 응모하셨습니다";
          cookie.classList.remove("crack");
          document.querySelector('#backBtn').style.display = 'block';

          const formData = new FormData();
          formData.append("entry.1171344104", localStorage.getItem('team'));
          formData.append("entry.2110575320", localStorage.getItem('name'));
          formData.append("entry.1161943199", selectedFortune);

          fetch("https://docs.google.com/forms/u/0/d/e/1FAIpQLSf6Mg-o8qzNXUWIy6iHCxax3oHxRypbPPkO69udn1ezDulv4Q/formResponse", {
              method: "POST",
              mode: "no-cors",
              body: formData
          });
        }, 600);
      }
    </script>
  </body>
</html>
